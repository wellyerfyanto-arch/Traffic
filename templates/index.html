<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Traffic Generator - Multi Proxy</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Google Traffic Generator - Multi Proxy</h1>
        
        <div class="dashboard">
            <div class="stats">
                <div class="stat-card">
                    <h3>Total Proxy</h3>
                    <span id="totalProxies">0</span>
                </div>
                <div class="stat-card">
                    <h3>Proxy Aktif</h3>
                    <span id="workingProxies">0</span>
                </div>
                <div class="stat-card">
                    <h3>Status</h3>
                    <span id="globalStatus">Ready</span>
                </div>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab-button active" onclick="openTab('trafficTab')">Traffic Generator</button>
            <button class="tab-button" onclick="openTab('proxyTab')">Proxy Management</button>
        </div>
        
        <!-- Traffic Generator Tab -->
        <div id="trafficTab" class="tab-content active">
            <div class="form-container">
                <form id="trafficForm">
                    <div class="form-group">
                        <label for="keyword">Kata Kunci Pencarian:</label>
                        <input type="text" id="keyword" name="keyword" 
                               value="teknologi terbaru 2024" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="website_url">URL Target Website:</label>
                        <input type="text" id="website_url" name="website_url" 
                               placeholder="contoh.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="iterations">Jumlah Iterasi:</label>
                        <select id="iterations" name="iterations">
                            <option value="1">1</option>
                            <option value="3">3</option>
                            <option value="5">5</option>
                            <option value="10">10</option>
                            <option value="20">20</option>
                        </select>
                    </div>
                    
                    <div class="button-group">
                        <button type="button" id="startBtn" onclick="startTraffic()">
                            üöÄ Mulai Traffic
                        </button>
                        <button type="button" id="stopBtn" onclick="stopTraffic()" disabled>
                            ‚èπÔ∏è Hentikan
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Proxy Management Tab -->
        <div id="proxyTab" class="tab-content">
            <div class="proxy-management">
                <div class="form-group">
                    <label for="proxies">Daftar Proxy (satu per baris, format: http://ip:port):</label>
                    <textarea id="proxies" name="proxies" rows="10" 
                              placeholder="http://45.77.56.101:3128&#10;http://51.158.68.68:8811&#10;http://163.172.157.7:8080"></textarea>
                </div>
                
                <div class="button-group">
                    <button type="button" onclick="updateProxies()">
                        üíæ Simpan Proxy
                    </button>
                    <button type="button" onclick="checkProxies()">
                        üîç Cek Proxy Aktif
                    </button>
                    <button type="button" onclick="loadDefaultProxies()">
                        üì• Load Default
                    </button>
                </div>
                
                <div class="proxy-lists">
                    <div class="proxy-list">
                        <h4>Proxy Aktif (<span id="activeCount">0</span>):</h4>
                        <div id="activeProxies" class="proxy-list-container"></div>
                    </div>
                    
                    <div class="proxy-list">
                        <h4>Semua Proxy (<span id="totalCount">0</span>):</h4>
                        <div id="allProxies" class="proxy-list-container"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="status-container">
            <h3>Status Real-time:</h3>
            <div id="statusDisplay" class="status">Ready</div>
            <div class="progress-container">
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
                <span id="progressText">0%</span>
            </div>
        </div>
        
        <div class="log-container">
            <h3>Log Aktivitas:</h3>
            <div class="log-controls">
                <button onclick="clearLog()">üßπ Bersihkan Log</button>
                <button onclick="exportLog()">üì• Export Log</button>
            </div>
            <div id="logDisplay" class="log"></div>
        </div>
    </div>

    <script>
        let statusInterval;
        let currentTab = 'trafficTab';
        
        function openTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Activate clicked button
            event.currentTarget.classList.add('active');
            currentTab = tabName;
            
            if (tabName === 'proxyTab') {
                loadProxies();
            }
        }
        
        function startTraffic() {
            const formData = {
                keyword: document.getElementById('keyword').value,
                website_url: document.getElementById('website_url').value,
                iterations: parseInt(document.getElementById('iterations').value)
            };
            
            if (!formData.website_url) {
                alert('Masukkan URL target website!');
                return;
            }
            
            fetch('/start_traffic', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                addLog('üöÄ Memulai proses traffic generation...');
                document.getElementById('startBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
                
                // Mulai polling status
                statusInterval = setInterval(updateStatus, 1000);
            })
            .catch(error => {
                addLog('‚ùå Error: ' + error.message);
            });
        }
        
        function stopTraffic() {
            fetch('/stop_traffic', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                addLog('‚èπÔ∏è Menghentikan traffic generation...');
                document.getElementById('startBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
                clearInterval(statusInterval);
            });
        }
        
        function updateStatus() {
            fetch('/status')
            .then(response => response.json())
            .then(data => {
                document.getElementById('statusDisplay').textContent = data.status;
                document.getElementById('globalStatus').textContent = data.status.split(':')[0];
                
                // Update progress
                if (data.total_iterations > 0) {
                    const progress = (data.current_iteration / data.total_iterations) * 100;
                    document.getElementById('progressFill').style.width = progress + '%';
                    document.getElementById('progressText').textContent = Math.round(progress) + '%';
                }
                
                if (data.status && !data.status.includes('Ready')) {
                    addLog(data.status);
                }
                
                // Jika selesai, enable start button
                if (data.status.includes('selesai') || data.status.includes('Error') || data.status.includes('Dihentikan')) {
                    document.getElementById('startBtn').disabled = false;
                    document.getElementById('stopBtn').disabled = true;
                    document.getElementById('progressFill').style.width = '0%';
                    document.getElementById('progressText').textContent = '0%';
                }
            });
        }
        
        function loadProxies() {
            fetch('/get_proxies')
            .then(response => response.json())
            .then(data => {
                document.getElementById('totalProxies').textContent = data.total_proxies;
                document.getElementById('workingProxies').textContent = data.working_proxies;
                document.getElementById('totalCount').textContent = data.total_proxies;
                document.getElementById('activeCount').textContent = data.working_proxies;
                
                // Display all proxies
                const allProxiesContainer = document.getElementById('allProxies');
                allProxiesContainer.innerHTML = data.proxy_list.map(proxy => 
                    `<div class="proxy-item">${proxy}</div>`
                ).join('');
                
                // Display working proxies
                const activeProxiesContainer = document.getElementById('activeProxies');
                activeProxiesContainer.innerHTML = data.working_list.map(proxy => 
                    `<div class="proxy-item active">‚úÖ ${proxy}</div>`
                ).join('');
            });
        }
        
        function updateProxies() {
            const proxiesText = document.getElementById('proxies').value;
            
            fetch('/update_proxies', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ proxies: proxiesText })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                if (data.status === 'success') {
                    loadProxies();
                }
            });
        }
        
        function checkProxies() {
            addLog('üîç Memeriksa proxy yang aktif...');
            loadProxies();
        }
        
        function loadDefaultProxies() {
            const defaultProxies = `http://45.77.56.101:3128
http://51.158.68.68:8811
http://163.172.157.7:8080
http://51.158.68.133:8811
http://51.158.68.26:8811
http://37.187.116.199:8118
http://195.154.51.58:8118
http://217.182.120.164:8080`;
            
            document.getElementById('proxies').value = defaultProxies;
        }
        
        function addLog(message) {
            const logDisplay = document.getElementById('logDisplay');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${message}`;
            logDisplay.prepend(logEntry);
            
            // Limit log entries
            if (logDisplay.children.length > 100) {
                logDisplay.removeChild(logDisplay.lastChild);
            }
        }
        
        function clearLog() {
            document.getElementById('logDisplay').innerHTML = '';
        }
        
        function exportLog() {
            const logEntries = document.querySelectorAll('.log-entry');
            let logText = 'Google Traffic Generator Log\\n\\n';
            
            logEntries.forEach(entry => {
                logText += entry.textContent + '\\n';
            });
            
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'traffic-log.txt';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // Load proxies on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadProxies();
            updateStatus();
        });
    </script>
</body>
                          </html>
