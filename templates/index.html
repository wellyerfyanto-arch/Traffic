<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Traffic Generator - Fixed Version</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 15px 35px rgba(0,0,0,0.2); overflow: hidden; }
        h1 { background: linear-gradient(135deg, #2c3e50, #34495e); color: white; padding: 25px; text-align: center; margin-bottom: 0; }
        
        .dashboard { padding: 20px; background: #f8f9fa; border-bottom: 1px solid #eee; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .stat-card { background: white; padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border-left: 4px solid #3498db; }
        .stat-card h3 { color: #7f8c8d; font-size: 14px; margin-bottom: 10px; text-transform: uppercase; }
        .stat-card span { font-size: 24px; font-weight: bold; color: #2c3e50; }
        
        .tabs { display: flex; background: #34495e; padding: 0; }
        .tab-button { flex: 1; padding: 15px; background: none; border: none; color: #bdc3c7; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .tab-button:hover { background: #3c5a7a; color: white; }
        .tab-button.active { background: #3498db; color: white; }
        
        .tab-content { display: none; padding: 30px; }
        .tab-content.active { display: block; }
        
        .form-group { margin-bottom: 25px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50; font-size: 14px; }
        input, select, textarea { width: 100%; padding: 14px; border: 2px solid #e1e8ed; border-radius: 8px; font-size: 16px; transition: all 0.3s; background: white; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #3498db; box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1); }
        textarea { resize: vertical; min-height: 120px; font-family: 'Courier New', monospace; font-size: 14px; }
        
        .button-group { display: flex; gap: 12px; margin-top: 30px; }
        button { flex: 1; padding: 16px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        #startBtn { background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; }
        #testBtn { background: linear-gradient(135deg, #3498db, #2980b9); color: white; }
        #stopBtn { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; }
        button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        button:disabled { background: #bdc3c7; cursor: not-allowed; transform: none; box-shadow: none; }
        
        .status-container { padding: 25px 30px; background: #f8f9fa; border-top: 1px solid #eee; }
        .status { padding: 18px; background: white; border-radius: 8px; font-weight: 600; color: #2c3e50; margin-bottom: 15px; border-left: 4px solid #3498db; }
        .step-status { padding: 15px; background: #2c3e50; color: white; border-radius: 8px; font-family: 'Courier New', monospace; margin-bottom: 10px; }
        
        .progress-container { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .progress-bar { flex: 1; height: 12px; background: #e1e8ed; border-radius: 6px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #27ae60, #2ecc71); border-radius: 6px; transition: width 0.3s ease; width: 0%; }
        #progressText { font-weight: 600; color: #2c3e50; min-width: 40px; }
        
        .proxy-lists { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; }
        .proxy-list h4 { margin-bottom: 15px; color: #2c3e50; font-size: 16px; }
        .proxy-list-container { max-height: 300px; overflow-y: auto; border: 1px solid #e1e8ed; border-radius: 8px; padding: 15px; background: #f8f9fa; }
        .proxy-item { padding: 10px; margin-bottom: 8px; background: white; border-radius: 5px; border-left: 4px solid #bdc3c7; font-family: 'Courier New', monospace; font-size: 12px; word-break: break-all; }
        .proxy-item.active { border-left-color: #27ae60; background: #d5f4e6; }
        
        .tips { background: #e8f4fd; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #3498db; }
        .tips h4 { color: #2c3e50; margin-bottom: 10px; }
        .tips ul { padding-left: 20px; }
        .tips li { margin-bottom: 5px; color: #555; }
        
        @media (max-width: 768px) {
            .container { margin: 10px; border-radius: 10px; }
            .stats { grid-template-columns: 1fr 1fr; }
            .proxy-lists { grid-template-columns: 1fr; }
            .button-group { flex-direction: column; }
            .tabs { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Google Traffic Generator - Fixed Version</h1>
        
        <div class="dashboard">
            <div class="stats">
                <div class="stat-card">
                    <h3>Total Proxy</h3>
                    <span id="totalProxies">0</span>
                </div>
                <div class="stat-card">
                    <h3>Proxy Aktif</h3>
                    <span id="workingProxies">0</span>
                </div>
                <div class="stat-card">
                    <h3>Status</h3>
                    <span id="globalStatus">Ready</span>
                </div>
                <div class="stat-card">
                    <h3>Iterasi</h3>
                    <span id="iterationStatus">0/0</span>
                </div>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab-button active" onclick="openTab('trafficTab')">üéØ Traffic Generator</button>
            <button class="tab-button" onclick="openTab('proxyTab')">üîß Proxy Management</button>
        </div>
        
        <!-- Traffic Generator Tab -->
        <div id="trafficTab" class="tab-content active">
            <div class="form-container">
                <form id="trafficForm">
                    <div class="form-group">
                        <label for="keyword">üîç Kata Kunci Pencarian:</label>
                        <input type="text" id="keyword" name="keyword" 
                               value="teknologi terbaru" required>
                        <small>Contoh: "review smartphone", "berita teknologi"</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="website_url">üåê URL Target Website:</label>
                        <input type="text" id="website_url" name="website_url" 
                               placeholder="tekno.com" required>
                        <small>Domain target tanpa https:// (contoh: detik.com, kompas.com)</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="iterations">üîÑ Jumlah Iterasi:</label>
                        <select id="iterations" name="iterations">
                            <option value="1">1 (Test)</option>
                            <option value="3">3</option>
                            <option value="5">5</option>
                            <option value="10">10</option>
                        </select>
                    </div>
                    
                    <div class="button-group">
                        <button type="button" id="startBtn" onclick="startTraffic()">
                            üöÄ Mulai Traffic
                        </button>
                        <button type="button" id="testBtn" onclick="testSingle()">
                            üß™ Test Single
                        </button>
                        <button type="button" id="stopBtn" onclick="stopTraffic()" disabled>
                            ‚èπÔ∏è Hentikan
                        </button>
                    </div>
                </form>
            </div>
            
            <div class="tips">
                <h4>üí° Tips untuk Hasil Terbaik:</h4>
                <ul>
                    <li>Gunakan keyword yang relevan dengan website target</li>
                    <li>Pastikan website target muncul di hasil pencarian Google</li>
                    <li>Gunakan proxy yang berkualitas (bukan free proxy)</li>
                    <li>Test dengan 1 iterasi dulu sebelum menjalankan banyak</li>
                    <li>Jika gagal, coba ganti keyword atau website target</li>
                </ul>
            </div>
        </div>
        
        <!-- Proxy Management Tab -->
        <div id="proxyTab" class="tab-content">
            <div class="proxy-management">
                <div class="form-group">
                    <label for="proxies">üìã Daftar Proxy (satu per baris):</label>
                    <textarea id="proxies" name="proxies" rows="8" 
                              placeholder="http://username:password@ip:port&#10;http://ip:port"></textarea>
                    <small>Format: http://ip:port atau http://user:pass@ip:port</small>
                </div>
                
                <div class="button-group">
                    <button type="button" onclick="updateProxies()">
                        üíæ Simpan Proxy
                    </button>
                    <button type="button" onclick="checkProxies()">
                        üîç Test Proxy Aktif
                    </button>
                    <button type="button" onclick="loadExampleProxies()">
                        üì• Contoh Proxy
                    </button>
                </div>
                
                <div class="proxy-lists">
                    <div class="proxy-list">
                        <h4>‚úÖ Proxy Aktif (<span id="activeCount">0</span>):</h4>
                        <div id="activeProxies" class="proxy-list-container"></div>
                    </div>
                    
                    <div class="proxy-list">
                        <h4>üìã Semua Proxy (<span id="totalCount">0</span>):</h4>
                        <div id="allProxies" class="proxy-list-container"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="status-container">
            <h3>üìä Status Real-time:</h3>
            <div class="progress-container">
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
                <span id="progressText">0%</span>
            </div>
            <div id="iterationProgress" class="step-status">Iterasi: 0/0</div>
            <div id="statusDisplay" class="status">Ready - Silakan setup proxy dan test terlebih dahulu</div>
            <div id="stepDisplay" class="step-status">Menunggu perintah...</div>
        </div>
    </div>

    <script>
        let statusInterval;
        let currentTab = 'trafficTab';
        
        function openTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
            currentTab = tabName;
            
            if (tabName === 'proxyTab') loadProxies();
        }
        
        function startTraffic() {
            const formData = {
                keyword: document.getElementById('keyword').value,
                website_url: document.getElementById('website_url').value,
                iterations: parseInt(document.getElementById('iterations').value)
            };
            
            if (!validateInput(formData)) return;
            
            fetch('/start_traffic', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'error') {
                    alert(data.message);
                    return;
                }
                document.getElementById('startBtn').disabled = true;
                document.getElementById('testBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
                statusInterval = setInterval(updateStatus, 1000);
            })
            .catch(error => console.error('Error:', error));
        }
        
        function testSingle() {
            const formData = {
                keyword: document.getElementById('keyword').value,
                website_url: document.getElementById('website_url').value,
                iterations: 1
            };
            
            if (!validateInput(formData)) return;
            
            fetch('/start_traffic', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'error') {
                    alert(data.message);
                    return;
                }
                document.getElementById('startBtn').disabled = true;
                document.getElementById('testBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
                statusInterval = setInterval(updateStatus, 1000);
            })
            .catch(error => console.error('Error:', error));
        }
        
        function validateInput(data) {
            if (!data.keyword.trim()) {
                alert('‚ö†Ô∏è Masukkan kata kunci pencarian!');
                return false;
            }
            if (!data.website_url.trim()) {
                alert('‚ö†Ô∏è Masukkan URL target website!');
                return false;
            }
            return true;
        }
        
        function stopTraffic() {
            fetch('/stop_traffic', {method: 'POST'})
            .then(response => response.json())
            .then(data => {
                document.getElementById('startBtn').disabled = false;
                document.getElementById('testBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
                clearInterval(statusInterval);
            });
        }
        
        function updateStatus() {
            fetch('/status')
            .then(response => response.json())
            .then(data => {
                document.getElementById('statusDisplay').textContent = data.status;
                document.getElementById('globalStatus').textContent = data.status;
                document.getElementById('stepDisplay').textContent = data.current_step;
                
                if (data.total_iterations > 0) {
                    const progress = (data.current_iteration / data.total_iterations) * 100;
                    document.getElementById('progressFill').style.width = progress + '%';
                    document.getElementById('progressText').textContent = Math.round(progress) + '%';
                    document.getElementById('iterationProgress').textContent = 
                        `Iterasi: ${data.current_iteration}/${data.total_iterations}`;
                    document.getElementById('iterationStatus').textContent = 
                        `${data.current_iteration}/${data.total_iterations}`;
                }
                
                if (data.status.includes('selesai') || data.status.includes('Error') || data.status.includes('Stopped')) {
                    document.getElementById('startBtn').disabled = false;
                    document.getElementById('testBtn').disabled = false;
                    document.getElementById('stopBtn').disabled = true;
                }
            })
            .catch(error => console.error('Error fetching status:', error));
        }
        
        function loadProxies() {
            fetch('/get_proxies')
            .then(response => response.json())
            .then(data => {
                document.getElementById('totalProxies').textContent = data.total_proxies;
                document.getElementById('workingProxies').textContent = data.working_proxies;
                document.getElementById('totalCount').textContent = data.total_proxies;
                document.getElementById('activeCount').textContent = data.working_proxies;
                
                const allProxiesContainer = document.getElementById('allProxies');
                allProxiesContainer.innerHTML = data.proxy_list.map(proxy => 
                    `<div class="proxy-item">${proxy}</div>`
                ).join('');
                
                const activeProxiesContainer = document.getElementById('activeProxies');
                activeProxiesContainer.innerHTML = data.working_list.map(proxy => 
                    `<div class="proxy-item active">‚úÖ ${proxy}</div>`
                ).join('');
            });
        }
        
        function updateProxies() {
            const proxiesText = document.getElementById('proxies').value;
            if (!proxiesText) {
                alert('‚ö†Ô∏è Masukkan daftar proxy!');
                return;
            }
            
            fetch('/update_proxies', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ proxies: proxiesText })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                if (data.status === 'success') loadProxies();
            });
        }
        
        function checkProxies() {
            alert('üîç Testing proxies...');
            loadProxies();
        }
        
        function loadExampleProxies() {
            const exampleProxies = `# Contoh format proxy (ganti dengan proxy Anda):
# http://username:password@ip:port
# http://ip:port

# Contoh:
# http://user123:pass123@45.77.56.101:3128
# http://51.158.68.68:8811`;
            
            document.getElementById('proxies').value = exampleProxies;
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            loadProxies();
            updateStatus();
        });
    </script>
</body>
                    </html>
